<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <title>IndraDB / map/reduce</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="lib/skeleton-2.0.4/css/normalize.css">
        <link rel="stylesheet" href="lib/skeleton-2.0.4/css/skeleton.css">
        <link rel="stylesheet" href="css/site.css">
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="column" style="margin-top: 50px">
                    <img src="logo-mini.png" alt="" width="50" height="50" style="float: left" />
                    <h1 style="position: relative; left: 10px; top: 5px;">
                        <a href="index.html">IndraDB</a> / map/reduce
                    </h1>

                    <p>
                        The server builds on its <a href="/scripting.html">scripting layer</a> to provide a map/reduce engine. When called, this will map over all of the vertices in the datastore, so it's a way to do full graph processing.
                    </p>

                    <p>
                        Map/reduce scripts have access to the same API as normal scripts, but they need to return a table specifying the map and reduce functions. For example, here is a map/reduce script that counts the number of vertices with type <code>foo</code>.
                    </p>

<pre><code>function map(vertex)
    if vertex.type == "foo" then
        return 1;
    else
        return 0;
    end
end

function reduce(first, second)
    return (first or 0) + second;
end

return { map=map, reduce=reduce }
</code></pre>

                    <p>Like scripts, map/reduce jobs are executed via the <a href="/http-api.html">http api</a>.</p>

                    <p>
                        When a map/reduce script is called, it distributes the map and reduce function calls across multiple threads. Each thread has its own lua context. The lua context is reused between calls. The consequence of this is that if you use global values, it will be visible across some (but not all) map and reduce function calls. For example, if you cached values for quicker lookup later, you would end up storing multiple redundant copies of the cache.
                    </p>
                </div>
            </div>
        </div>
    </body>
</html>
