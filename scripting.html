<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <title>IndraDB / scripting</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="lib/skeleton-2.0.4/css/normalize.css">
        <link rel="stylesheet" href="lib/skeleton-2.0.4/css/skeleton.css">
        <link rel="stylesheet" href="css/site.css">
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="column" style="margin-top: 50px">
                    <img src="logo-mini.png" alt="" width="50" height="50" style="float: left" />
                    <h1 style="position: relative; left: 10px; top: 5px;">
                        <a href="index.html">IndraDB</a> / scripting
                    </h1>

                    <p>
                        The server has a lua-based scripting layer, which allows you to run several requests without
                        the network overhead of repeated HTTP API requests. Scripts are executed via a request to the
                        HTTP API.
                    </p>

                    <p>
                        See the <a href="https://github.com/indradb/indradb/tree/master/bin/test_scripts/execute">tesst scripts</a>  for examples.
                    </p>

                    <p>
                        The global <code>arg</code> variable represents the JSON payload passed in when the script request was made. The JSON is serialized to equivalent Lua values (e.g. objects and arrays are converted to tables) for convenience.
                    </p>

                    <p>
                        Additionally, the below globally-defined userdata and functions are provided for querying against the IndraDB datastore.
                    </p>

                    <h2><code>EdgeKey</code></h2>

                    <p>Table for representing <a href="https://indradb.github.io/concepts.html#edge-keys">edge keys</a>.</p>

                    <div class="card">
                        <p><code>EdgeKey.new</code> - Creates a new edge key.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>outbound_id</code> - The outbound vertex ID.
                            </li>
                            <li>
                                <code>type</code> - The edge type. Must be less than 256 characters long, and can
                                only contain letters, numbers, dashes, and underscores.
                            </li>
                            <li>
                                <code>inbound_id</code> - The inbound vertex ID.
                            </li>
                        </ol>

                        <p>Returns the new edge key.</p>
                    </div>

                    <h2><code>VertexQuery</code></h2>

                    <p>Table for representing <a href="https://indradb.github.io/concepts.html#vertex-queries">vertex queries</a>.</p>

                    <div class="card">
                        <p><code>VertexQuery.all</code> - Creates a new vertex query to get a range from all vertices.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>start_id</code> - The offset ID to start from, or <code>nil</code> to start from the beginning.
                            </li>
                            <li>
                                <code>limit</code> - Up to how many vertices to return.
                            </li>
                        </ol>

                        <p>Returns a new vertex query.</p>
                    </div>

                    <div class="card">
                        <p><code>VertexQuery.vertices</code> - Creates a new vertex query to get a specific set of vertices.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>ids</code> - The specific vertex UUIDs to get.
                            </li>
                        </ol>

                        <p>Returns a new vertex query.</p>
                    </div>

                    <div class="card">
                        <p><code>query:outbound_edges</code> - A vertex query method to get the outbound edges of the vertices.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>type</code> - The edge type. Must be less than 256 characters long, and can
                                only contain letters, numbers, dashes, and underscores.
                            </li>
                            <li>
                                <code>high</code> - A UNIX timestamp representing the upper bound age of edges that should be returned.
                            </li>
                            <li>
                                <code>low</code> - A UNIX timestamp representing the lower bound age of edges that should be returned.
                            </li>
                            <li>
                                <code>limit</code> - Up to how many edges to return.
                            </li>
                        </ol>

                        <p>Returns a new edge query.</p>
                    </div>

                    <div class="card">
                        <p><code>query:inbound_edges</code> - A vertex query method to get the inbound edges of the vertices.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>type</code> - The edge type. Must be less than 256 characters long, and can
                                only contain letters, numbers, dashes, and underscores.
                            </li>
                            <li>
                                <code>high</code> - A UNIX timestamp representing the upper bound age of edges that should be returned.
                            </li>
                            <li>
                                <code>low</code> - A UNIX timestamp representing the lower bound age of edges that should be returned.
                            </li>
                            <li>
                                <code>limit</code> - Up to how many edges to return.
                            </li>
                        </ol>

                        <p>Returns a new edge query.</p>
                    </div>

                    <h2><code>EdgeQuery</code></h2>

                    <p>Table for representing <a href="https://indradb.github.io/concepts.html#edge-queries">edge queries</a>.</p>

                    <div class="card">
                        <p><code>EdgeQuery.edges</code> - Creates a new edge query to get a specific set of edges.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>keys</code> - The specific edge keys of the edges to get.
                            </li>
                        </ol>

                        <p>Returns a new vertex query.</p>
                    </div>

                    <div class="card">
                        <p><code>query:outbound_vertices</code> - A vertex query method to get the outbound vertices of the edges.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>limit</code> - Up to how many vertices to return.
                            </li>
                        </ol>

                        <p>Returns a new edge query.</p>
                    </div>

                    <div class="card">
                        <p><code>query:inbound_vertices</code> - A vertex query method to get the inbound vertices of the edges.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>limit</code> - Up to how many vertices to return.
                            </li>
                        </ol>

                        <p>Returns a new edge query.</p>
                    </div>

                    <h2><code>Vertex</code></h2>

                    <p>Userdata for representing a vertex.</p>

                    <div class="card">
                        <p><code>vertex</code> - Creates a new vertex.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>type</code> - The edge type. Must be less than 256 characters long, and can
                                only contain letters, numbers, dashes, and underscores.
                            </li>
                        </ol>

                        <p>Returns a new transaction.</p>
                    </div>

                    <h2><code>Transaction</code></h2>

                    <p>Userdata for representing transactions.</p>

                    <div class="card">
                        <p><code>transaction</code> - Creates a new transaction.

                        <p>Returns a new transaction.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:create_vertex</code> - Creates a new vertex.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>type</code> - The vertex type. Must be less than 256 characters long, and can
                                only contain letters, numbers, dashes, and underscores.
                            </li>
                        </ol>

                        <p>Returns the new vertex UUID.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:get_vertices</code> - Gets vertices by a given query.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#vertex-queries">vertex query</a> to
                                use.
                            </li>
                        </ol>

                        <p>Returns the a list of the vertices matching the query.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:delete_vertices</code> - Deletes vertices by a given query.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#vertex-queries">vertex query</a> to
                                use.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:create_edge</code> - Creates a new edge.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>key</code> - The <a href="concepts.html#edge-keys">edge key</a> that identifies
                                the edge.
                            </li>
                            <li>
                                <code>weight</code> - The weight to set the edge to; it must be between -1.0 and 1.0.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:get_edges</code> - Gets edges by a given query.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#edge-queries">edge query</a> to
                                use.
                            </li>
                        </ol>

                        <p>Returns a list of the edges matching the query.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:get_edge_count</code> - Gets the number of edges that match a given query.

                        <p>Arguments:</p>
                        <ul>
                            <li>
                                <code>id</code> - The vertex ID to get the edge count on.
                            </li>
                            <li>
                                <code>type_filter</code> - What edge types to count, or <code>nil</code> for all edge types.
                            </li>
                            <li>
                                <code>direction</code> - <code>outbound</code> to count outbound edges, or <code>inbound</code> to count inbound edges.
                            </li>
                        </ul>

                        <p>Returns the number of edges that match the query.</p>
                    </div>

                    <div class="card">
                        <p><code>trans:delete_edges</code> - Deletes edges by a given query.

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#edge-queries">edge query</a> to
                                use.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:get_global_metadata</code> - Gets a global
                            <a href="concepts.html#metadata">metadata</a> value.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>Returns the metadata value.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:set_global_metadata</code> - Sets a global
                            <a href="concepts.html#metadata">metadata</a> value.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                            <li>
                                <code>value</code> - The metadata value.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:delete_global_metadata</code> - Deletes a global
                            <a href="concepts.html#metadata">metadata</a> value.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:get_vertex_metadata</code> - Gets vertex
                            <a href="concepts.html#metadata">metadata</a> values by a vertex query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#vertex-queries">vertex query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>
                            Returns a list of objects, each of which contains the vertex <code>id</code> and
                            metadata <code>value</code>.
                        </p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:set_vertex_metadata</code> - Sets vertex
                            <a href="concepts.html#metadata">metadata</a> values by a vertex query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#vertex-queries">vertex query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                            <li>
                                <code>value</code> - The metadata value.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:delete_vertex_metadata</code> - Deletes vertex
                            <a href="concepts.html#metadata">metadata</a> values by a vertex query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#vertex-queries">vertex query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:get_edge_metadata</code> - Gets edge
                            <a href="concepts.html#metadata">metadata</a> values by an edge query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#edge-queries">edge query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>
                            Returns a list of objects, each of which contains the edge <code>key</code> and
                            metadata <code>value</code>.
                        </p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:set_edge_metadata</code> - Sets edge
                            <a href="concepts.html#metadata">metadata</a> values by an edge query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#edge-queries">edge query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                            <li>
                                <code>value</code> - The metadata value.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>

                    <div class="card">
                        <p>
                            <code>trans:delete_edge_metadata</code> - Deletes edge
                            <a href="concepts.html#metadata">metadata</a> values by an edge query.
                        </p>

                        <p>Arguments:</p>
                        <ol>
                            <li>
                                <code>query</code> - The <a href="concepts.html#edge-queries">edge query</a> to run.
                            </li>
                            <li>
                                <code>name</code> - The name of the metadata variable.
                            </li>
                        </ol>

                        <p>Returns nothing.</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
